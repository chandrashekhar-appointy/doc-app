steps:
  # Install dependencies
  - name: 'node:20'
    entrypoint: 'npm'
    args: ['ci']

  # Build the Next.js app
  - name: 'node:20'
    entrypoint: 'npm'
    args: ['run', 'build']

  # Export the static site (for Nextra/Next.js static export)
  # - name: 'node:20'
  #   entrypoint: 'npm'
  #   args: ['run', 'export']

  # Upload the static site to your GCS bucket
  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        gsutil -m rsync -r .next gs://idp-system-upload-bucket/nextjs-site

artifacts:
  objects:
    location: 'gs://idp-system-upload-bucket/nextjs-artifacts'
    paths: ['.next/**'] 